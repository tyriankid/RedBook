function minusBuyNum() { var b = $("#buyNum").val(); var a = subtract(b); $("#buyNum").val(a); $("[role='happyBean']").html(a) } function addBuyNum() { var a = $("#popup1"); var c = $("#buyNum").val(); var b = plus(c); if (parseInt(a.attr("renshuLeft") * yunjiage) >= b) { $("#buyNum").val(b); $("[role='happyBean']").html(b) } else { } } function quickBuy(a) { if ($(a).find("a").attr("dis") == "true") { return } var b = $(a).text() * yunjiage; $("#buyNum").val(b); $("[role='happyBean']").html(b) } function plus(a) { a = parseInt(a); if ((a % parseInt(yunJiage))) { a = (parseInt(a / parseInt(yunJiage)) + 1) * parseInt(yunJiage) } a += parseInt(yunJiage); return a } function subtract(a) { a = parseInt(a); if ((a % parseInt(yunJiage))) { a = (parseInt(a / parseInt(yunJiage)) + 1) * parseInt(yunJiage) } if (a > parseInt(yunJiage)) { a -= parseInt(yunJiage) } return a } function trim(a) { if (a.length > 0) { if (a.charAt(0) == " ") { a = a.substring(1, a.length) } if (a.charAt(a.length - 1) == " ") { a = a.substring(0, a.length - 1) } if (a.charAt(0) == " " || a.charAt(a.length - 1) == " ") { return trim(a) } } return a } function lockCoverDivMOdel(b) { var a; return function () { return a = a || (a = b.apply(this, arguments)) } } var leftmoney, paytype, redpacknum; var canPay = 0; var imgUrl, codeId, yunJiage, priceRangeArray, renshuLeft; var codeid, yunjiage, renshuleft; var sign, shopid, quantity, paytype, APIsubmitcode, redpaper; var showQuickPayDiv = lockCoverDivMOdel(function () { var d = "	<div class='popup_layer-bg clearfix' id='popup1' style='display: none;' >"; d += "<div class='popup_layer-box clearfix'>"; d += "<div class='popup-nrbox2'><div class='pro-ttbox'>"; d += "<img class='pro-img' role='quickBuyImg' src='' />"; d += "<h1>请选择参与人次</h1><a href='javascript:;' class='link-close' onclick='CloseDiv(\"all\")' >+</a>"; d += "</div><div class='pro-infobox'><div class='pro-num'><span class='shopcart-minus' onclick='minusBuyNum()'>-</span>"; d += "<input type='tel' id='buyNum' class='form-num' onkeyup=\"value=value.replace(/\\D/g,'')\" value='1'>"; d += "<span class='shopcart-add' onclick='addBuyNum()'>+</span>"; d += "</div>"; d += "<p role='singlePriceAlert'></p>"; d += "<ul class='pro-numlist clearfix' id='ulpricerange'></ul>"; d += "<div class='pro-money clearfix'>共<b role='happyBean'>1</b>爽乐币"; d += "</div><div class='twobtn_box'>"; d += "<a href='javascript:;' class='closebtn' onclick='pay(leftmoney,paytype,redpacknum)'>确定</a>"; d += "</div></div></div> </div> </div>"; codeid = codeId; yunjiage = yunJiage; renshuleft = renshuLeft; if ((yunjiage + " ").indexOf(".") >= 0) { yunjiage = yunjiage.replace(".00", "") } yunJiage = yunjiage; if (canPay == 1) { return } $("body").append(d).append(alertboxHtml); if (yunjiage != 1) { $("#buyNum").val(yunjiage); $("#popup1").find("[role='happyBean']").text(yunjiage) } if (yunjiage > 1) { $("[role='singlePriceAlert']").html("单人次需消耗" + yunjiage + "爽乐币") } var b = $("#popup1"); b.css("display", "block"); b.find("[role='quickBuyImg']").attr("src", imgUrl); b.find(".closebtn").attr("codeid", codeId).attr("yunjiage", yunJiage); $("#ulpricerange").html(""); var c = /^\\d+$/; for (var a = 0; a < priceRangeArray.length; a++) { if (isNaN(priceRangeArray[a])) { continue } $("#ulpricerange").append('<li onclick="quickBuy(this)"><a href="javascript:;">' + priceRangeArray[a] + "</a></li>") } b.attr("renshuLeft", renshuLeft); b.find(".pro-numlist li").each(function () { if (parseInt(renshuLeft) < parseInt($(this).find("a").html())) { $(this).html(("<a style='background:#DDD' dis='true'>" + $(this).find("a").html() + "</a>")) } else { $(this).html(("<a >" + $(this).find("a").html() + "</a>")) } }); canPay = 1 }); var reloadPage = false; function pay(b, f, e) { if (canPay == 0) { return false } canPay = 0; var j = $("#buyNum"); var h = trim(j.val()); if (h == "") { alertBox("请输入购买数量!"); CloseDiv(); return false } else { if (h > parseInt($("#popup1").attr("renshuLeft")) * yunjiage) { j.val($("#popup1").attr("renshuLeft") * yunjiage) } } var k = $(this).attr("codeid"); if (h < parseInt(yunJiage)) { h = parseInt(yunJiage) } else { if ((h % parseInt(yunJiage))) { h = parseInt(h / parseInt(yunJiage)) * yunjiage } } if (h > parseInt($("#popup1").attr("renshuLeft")) * yunjiage) { h = parseInt($("#popup1").attr("renshuLeft")) * yunjiage } buyNum = parseInt(h / yunjiage); if (buyNum > 5000) { if (confirm("单次购买人次不得超过5000,是否将购买人次设为5000？")) { buyNum = 5000; $("#buyNum").val(5000 * yunjiage) } else { CloseDiv(); return } } $("#buyNum").val(buyNum * yunjiage); shopid = k; quantity = buyNum; redpaper = 0; APIsubmitcode = ""; paytype = "0"; var a = "http://" + window.location.host + "/ilerrpay?action=userpayment&shopid=" + shopid + "&quantity=" + quantity; var g; var c = false; $.ajax({ type: "get", dataType: "json", timeout: 10000, async: false, url: a, success: function (l) { if (l.isPayOut == "11") { if (!confirm("支付失败,您今日已消费达5000元,确定继续支付吗?")) { c = true; CloseDiv() } } if (l.usemoney == "1" && l.useredpaper == "0") { g = true } else { g = false } } }); if (c) { return } if (g) { $(".closebtn").html("正在支付中..."); var d = ""; $.getJSON("http://" + window.location.host + "/ilerrpay?action=userpaymentsubmit&shopid=" + shopid + "&quantity=" + quantity + "&paytype=" + paytype + "&ip=" + d, function (l) { switch (l.state) { case 0: CloseDiv(); alertBox("支付成功!", callQuickPay(f)); break; default: alertBox("支付失败!错误码：" + l.state); break } CloseDiv() }) } else { location.href = "http://" + window.location.host + "/WxPay/cart.payment.aspx?yid=" + shopid + "&quantity=" + quantity } } function callQuickPay(a) { switch (a) { case "ajaxPay": if (!GuanzhuRemind()) { return } getrefdata(); getLottery(true); break; case "singleAjaxPay": if (!GuanzhuRemind()) { return } reloadPage = true; break; case "allgoods": if (!GuanzhuRemind()) { return } glist_json(id); break } } function CloseDiv(a) { $("#popup1").remove(); if (a == "all") { $(".mask").remove(); $(".alertBox").remove() } canPay = 0 } var alertboxHtml = "<div class='mask'></div>"; alertboxHtml += "<div class='alertBox'>"; alertboxHtml += "<p class='content'>请选择支付方式</p>"; alertboxHtml += "<p class='close' onclick='closeAlertBox()'>关闭</p></div>"; function alertBox(a, b) { $(".alertBox .content").text(a); $(".mask").show(); $(".alertBox").show() } function closeAlertBox(eventname) { if (reloadPage == true) { location.href = "http://" + window.location.host + "/index.item.aspx?shopid=" + codeid } $(".mask").remove(); $(".alertBox").remove(); if (eventname !== null || eventname !== undefined || eventname !== "") { eval(eventname) } return false } function wxAlertDiv(b) { var a = '<div class="PopupBg clearfix" id="InfoPopupBg"></div><div class="PopupLayer" id="InfoPopup"><h1>操作提示</h1><div class="po-nrbox"><h2></h2></div><div class="OnebtnBox"><div class="btn">我知道了</div></div></div>'; $("body").append(a); $("#InfoPopup .btn").click(function () { removeAlertDiv(b) }) } var windowWidth = document.documentElement.clientWidth; var windowHeight = document.documentElement.clientHeight; function showAlertDiv(a, b) { wxAlertDiv(b); $("#InfoPopupBg").show(); $("#InfoPopup").show(); $("#InfoPopup .po-nrbox h2").text(a); var c = $("#InfoPopup").height(); var d = $("#InfoPopup").width(); $("#InfoPopup").css({ top: (windowHeight - c) / 2, left: (windowWidth - d) / 2 }); return false } function removeAlertDiv(eventname) { $("#InfoPopupBg").remove(); $("#InfoPopup").remove(); if (eventname !== null || eventname !== undefined || eventname !== "") { eval(eventname) } return false } function GuanzhuRemind() { var b = true; var a = "http://" + window.location.host + "/ilerruser?action=getsubscribe"; $.ajax({ type: "get", dataType: "json", timeout: 10000, async: false, url: a, success: function (d) { if (d.state == 0) { var c = ""; c += '<div class="GuanzhuPopup clearfix" id="GuanzhuPopup" style="display:block;"><div class="Poplayer clearfix"><div class="fixedbox"><h1>支付成功！</h1><div class="ewmbox"><img src="/images/icon/qrcode_taotaole.jpg" /></div><p>您目前尚未关注“爽乐购”官方微信号！<br />为了方便您领取奖品请先关注， <br />长按识别图中二维码，点击关注即可！</p></div></div></div>'; $("body").append(c); b = false } } }); return b } function scrollFunc(a) { a = a || window.event; if (a && a.preventDefault) { a.preventDefault(); a.stopPropagation() } else { a.returnvalue = false; return false } } var chk_pwd = { passwd: function (c, a) { if (/[\w\W]{8,20}/.test(c)) { if (!/^password|qwerasdf|iloveyou|(.)\1{7,19}/.test(c)) { for (var b = 1; b < c.length; b++) { if (Math.abs(c.charCodeAt(b - 1) - c.charCodeAt(b)) != 1) { return true } } } a.msg = "为保障您的账户安全，禁止使用弱密码" } return false } }; function lockCoverDivMOdel(b) { var a; return function () { return a = a || (a = b.apply(this, arguments)) } } var creatDiv = lockCoverDivMOdel(function () { var a = window.innerHeight; var c = document.createElement("div"); c.setAttribute("id", "coverDiv"); c.setAttribute("class", "coverDiv"); c.style.height = a; var b = "<span class='cover_loading_img'><img src=" + Img_Path + "/touch/loading.gif width='32px' /></span><div class='cover_opacity_div'></div>"; c.innerHTML = b; return document.body.appendChild(c) }); function getMvcode(e, a, c, b) { $subdata = { mobile: e, stype: (a ? a : 1), deviceid: localStorage.ssr_deviceid }; $.extend($subdata, ssrTokendeviceid); delete $subdata.token; var b = b ? b : 120; var d = c == "weixin" ? "/weixin/common/mvcode" : "/app/common/mvcode"; $.post(d, $subdata, function (f) { if (f.err == 0) { $("#gpc_btn").hide(); $("#re_get").show(); $(".form_errors").hide(); countTime($("#re_get"), $("#gpc_btn"), $("#re_get em"), b) } else { $("#error_tips var").html(f.msg); $("#error_tips").show() } if (f.ssid && ssrTokendeviceid.ssid != f.ssid) { ssrTokendeviceid.ssid = f.ssid } }) } function getNewpage(c, b) { var a; var d = c.replace(/\?(.*)?$/, ""); d = d.split("/"); var b = b ? b : (d.length > 3 ? d[2] + "_" + d[3] : d[2]); dataCollectionModel[b] = dataCollectionModel[b] || {}; var e = ssrTokendeviceid ? ssrTokendeviceid : {}; $.ajax({ type: "POST", url: c, dataType: "json", data: e, async: false, beforeSend: function () { creatDiv(); $("#coverDiv").show() }, complete: function () { $("#coverDiv").hide() }, success: function (f) { $("#coverDiv").hide(); if (f.err == 0) { for (r in f) { switch (r) { case "msg": case "err": break; case "ssid": dataCollectionModel.ssid = f.ssid; break; default: if (dataCollectionModel[b][r]) { if (dataCollectionModel[b][r].constructor === Array) { dataCollectionModel[b][r] = dataCollectionModel[b][r].concat(f[r]) } else { if (dataCollectionModel[b][r].constructor === Object) { $.extend(dataCollectionModel[b][r], f[r]) } else { dataCollectionModel[b][r] = f[r] } } } else { dataCollectionModel[b][r] = f[r] } } } } a = f }, error: function (f) { a = f; $("#coverDiv").hide() } }); return a } function getAjax(d, c, b) { var f, e = 1, a = false; if (!b) { f = getNewpage(d, c) } else { f = getNewpage(d, c); if (f.err == 0) { if (f.count > e) { a = true } page++ } $(window).scroll(function () { var g = $(window).scrollTop(); var k = $(document.body).height(); var j = $(window).height(); var h = d + "&page=" + page; if (g + j >= k && a) { getNewpage(h, c, true) } }) } } function ajaxPost(c, a, d) { var b; var d = d ? d : false; $.ajax({ type: "POST", url: c, data: a, dataType: "json", async: false, success: function (e) { if (e.err != 0 && d) { $("#error_tips var").html(e.msg); $("#error_tips").show() } b = e }, error: function () { b = { err: "fail" } } }); return b } function formatMoney(b, d) { d = d > 0 && d <= 20 ? d : 2; b = parseFloat((b + "").replace(/[^\d\.-]/g, "")).toFixed(d) + ""; var a = b.split(".")[0].split("").reverse(), c = b.split(".")[1]; t = ""; for (i = 0; i < a.length; i++) { t += a[i] + ((i + 1) % 3 == 0 && (i + 1) != a.length ? "," : "") } return t.split("").reverse().join("") + (c && parseInt(c) > 0 ? "." + c : "") } function addZero(a) { a = parseInt(a); var b = a < 10 ? "0" + a : a; return b } function countTime(d, c, a, b) { $(a).html(b); if (b == 0) { $(d).hide(); $(c).show() } else { if (b > 0) { b--; setTimeout(function () { countTime(d, c, a, b) }, 1000) } } } function countRestTime(f) { if (f === undefined) { f = 0 } var c = new Date(); c = c.getTime(); c = f - parseInt(c / 1000); var e = { minutes: 60, hours: 60 * 60, day: 60 * 60 * 24, }; if (c >= 0) { var b = Math.floor(c / e.day); var a = Math.floor((c % e.day) / e.hours); var d = Math.floor((c - b * e.day - a * e.hours) / e.minutes); var g = Math.floor(c - b * e.day - a * e.hours - d * e.minutes); b = addZero(b); a = addZero(a); d = addZero(d); g = addZero(g) } else { var b = "00", a = "00", d = "00", g = "00" } return { day: b, hours: a, minutes: d, seconds: g } } function formatTime(e, g, o, b) { var j = arguments.length; var a = j == 0 ? new Date() : new Date(e); var d = [a.getFullYear(), addZero(parseInt(a.getMonth()) + 1), addZero(a.getDate()), addZero(a.getHours()), addZero(a.getMinutes()), addZero(a.getSeconds())]; var c = "-", l = 0, f = 6; switch (j) { case 4: c = g; l = o >= 5 ? 5 : o; f = b >= 6 ? 6 : b; break; case 3: c = isNaN(arguments[1]) ? g : "-"; l = isNaN(arguments[1]) ? 0 : arguments[1] >= 5 ? 5 : arguments[1]; f = arguments[2] >= 6 ? 6 : arguments[2]; break; case 2: c = isNaN(arguments[1]) ? g : "-"; l = 0; f = isNaN(arguments[1]) ? 6 : arguments[1] >= 6 ? 6 : arguments[1]; break; default: c = "-"; l = 0; f = 6; break } var k = d[l]; for (var h = l + 1; h < l + f; h++) { if (h < 3) { if (c == "w") { k += (h == 1 ? "年" : "月") } else { k += c } } else { if (h == 3) { k += " " } else { k += ":" } } k += d[h]; if (h == 2 && c == "w") { k += "日" } } return k } function loadFiles(a, d, c) { var e = document.createElement("iframe"); e.setAttribute("id", "loadFiles"); e.style.display = "none"; var b = document.createElement("form"); b.setAttribute("id", "upfilesForm"); b.setAttribute("method", "POST"); b.setAttribute("action", a); b.innerHTML = d; b.submit() } function sortNum(d, c) { return d - c } Array.prototype.max = function () { var a = this; var c = a[0]; for (var b = 1; b < a.length; b++) { if (a[b] > c) { c = a[b] } } return c }; Array.prototype.min = function () { var a = this; var c = a[0]; for (var b = 1; b < a.length; b++) { if (a[b] < c) { c = a[b] } } return c }; Array.prototype.elIndex = function (f) { var a = this, d; if (f.constructor === Array) { var e = f, c = true; for (d = 0; d < a.length; d++) { if (a[d].constructor === Array) { for (var b = 0; b < a.length; b++) { if (a[d][b] != f[b]) { c = false } } return (c ? d : -1) } } return -1 } else { for (d = 0; d < a.length; d++) { if (a[d] == f) { return d } } } return -1 }; document.onkeydown = function (a) { a = window.e || a; key = a.keyCode || a.keyChar || a.which; if (key == 13) { $("#submit").click() } }; function WinRemind() { var a = "http://" + window.location.host + "/ilerrorder?action=winningremind"; $.ajax({ type: "get", dataType: "json", timeout: 10000, url: a, success: function (c) { if (c.iswin == 0) { return } if (c.iswin == 1) { if ($("#winingAlert").length > 0) { $("#winingAlert").remove() } var b = ""; b += '<link href="/css/winning.css" rel="stylesheet" type="text/css" /><div class="Winning-popup clearfix" id="winingAlert" style="display:block;"><div class="popup_layer-box clearfix"><a href="javascript:;" class="link-close" style="display:block;z-index:10;" >+</a><div class="fixedbox"><div class="po-winningbox"><div class="Winning-img"><img id="winningImg" src="/images/Winning.png" /></div></div><div class="wininfobox"><div class="wininfo clearfix"><p>爽乐购恭喜您获得</p><h4>第<span class="periods">' + c.qishu + '</span>期</h4><ul class="productName">' + c.title + '</ul></div><div class="twobtn_box2"><a href="/user.winningconfirm.aspx?shopid=' + c.yid + "&orderid=" + c.orderid + "&productid=" + c.productid + '" class="kanbtn" >查看</a><a href="javascript:;" class="sharebtn" >分享</a></div></div></div></div><div class="winshare_box" style="display:none;"></div></div>'; $("body").append(b); $(".sharebtn").click(function () { $(".winshare_box").show(); $(".popup_layer-box").hide() }); $(".winshare_box").click(function () { $(".winshare_box").hide() }); $(".Winning-popup .link-close,.winshare_box").click(function () { if ($(".winshare_box").is(":visible")) { $(".winshare_box").hide() } else { $(".Winning-popup").hide() } }) } setWxShareInfo(c) } }) } function setWxShareInfo(e) { var b = e.imgroot + e.thumb; var d = "我在爽乐购中了" + e.title; var f = "来跟我拼一拼手气吧！"; var c = "http://" + window.location.host + "/index.userindex.aspx?luckyListOpen=1&uid=" + e.uid; WinXinShareMessage(d, f, c, b); document.addEventListener("WeixinJSBridgeReady", function a() { WeixinJSBridge.call("showOptionMenu") }) } function goBackTop() { $("html,body").animate({ scrollTop: 0 }, 0) } var refvalue = 0; function refresh() { refvalue += 360; $("#imgref").rotate({ animateTo: refvalue }); $(".pullUpLabel").text("加载中"); $(".pullUpLabel").prev().show(); getrefdata(); getdata(true); getLottery(true) } window.onload = function () { FastClick.attach(document.body); setWxShareInfoDefault(); getdata(false); getLottery(); var a = ".goodsList span,.goodsList h2,.goodsList .Progress-bar"; $(document).on("click", a, function () { var e = $(this).attr("id"); if (e) { var c = "/index.item.aspx?productid=" + e + "&operation=" + $(this).attr("name"); var b = $("#pagenum").val(); var d = $("body").scrollTop(); SetCookie("sitPos", "1"); SetCookie("page", b); SetCookie("pos", d); window.location.href = c } }); getSlidePic() }; function SetCookie(b, a) { date = new Date(); s = date.getDate(); date.setDate(s + 1); document.cookie = b + "=" + escape(a) + "; expires=" + date.toGMTString() } function GetCookie(d) { var b = document.cookie.split("; "); for (var a = 0; a < b.length; a++) { var c = b[a].split("="); if (d == c[0]) { return unescape(c[1]) } } return null } function setPaymentParms(b) { var a = b.closest("li"); imgUrl = a.find("img").attr("src"); codeId = b.attr("codeid"); yunJiage = b.attr("yunjiage"); priceRangeArray = b.attr("pricerange").split(","); renshuLeft = a.find("[role='renshuLeft" + b.attr("productid") + "']").html(); paytype = "ajaxPay"; showQuickPayDiv() } var nextPage = 1; var refp = 1; function getdata(d) { var f = GetCookie("sitPos"); var e = GetCookie("page"); var g = GetCookie("pos"); if (d) { var b = new Date(); var c = b.toLocaleDateString() + " " + b.getHours() + ":" + b.getMinutes() + ":" + b.getSeconds(); $.cookie("reftime", c); nextPage = 1; $(".goodsList ul").remove() } if (nextPage == 0) { return } if (f == "1") { var a = "http://" + window.location.host + "/ilerrshop?action=listinfo&typeid=list&order=10&p=1&pageSize=" + (e - 1) } else { var a = "http://" + window.location.host + "/ilerrshop?action=listinfo&typeid=list&order=10&p=" + nextPage } console.log(a); $.ajax({ type: "get", dataType: "json", timeout: 10000, url: a, success: function (m) { console.log(m); if (m.nextPage != 0) { $("#pagenum").val(m.nextPage) } else { if (m.pageCount > 1 && m.nextPage == 0) { var j = Number($("#pagenum").val()); $("#pagenum").val(j + 1) } } nextPage = m.nextPage; if (nextPage == 0) { $(".pullUpLabel").text("已加载完全部商品"); $(".pullUpLabel").prev().hide() } if (nextPage != 0) { refp = nextPage - 1 } else { refp = refp + 1 } for (var k = 0; k < m.data.length; k++) { var j = (m.data[k].canyurenshu / m.data[k].zongrenshu) * 100; j = j.toFixed(2); var l = ""; l += '<ul><li><span id="' + m.data[k].productid + '" name="' + m.data[k].operation + '" class="z-Limg" style="position:relative;display:block;"><img src="' + m.imgroot + m.data[k].thumb + '"></span><div style="margin-top:15px;" class="goodsListR"><h2 id="' + m.data[k].productid + '">' + m.data[k].title + '</h2></div><div class="pRate item_bottom_container"><div class="goods-num"><div class="Progress-bar" id="' + m.data[k].productid + '"><p class="u-progress" style="margin-left:0;"><span class="pgbar" style="width:' + j + '%;" id="pgbar' + m.data[k].productid + '"><span class="pging"></span></span></p><div class="Pro-bar-li"><div class="P-bar02"><em>' + m.data[k].zongrenshu + '</em>总需</div><div class="P-bar03"><em role="renshuLeft' + m.data[k].productid + '">' + m.data[k].shengyurenshu + '</em>剩余</div></div></div></div><div class="link-playbox"><a onclick="setPaymentParms($(this))" class="link-play" productid="' + m.data[k].productid + '" codeid="' + m.data[k].yId + '" pricerange="' + m.data[k].pricerange + '" yunjiage="' + m.data[k].yunjiage + '" href="javascript:void(0)">参与</a></div></div></li></ul>'; $("#divGoodsLoading").before(l) } if (d) { var k = document.createElement("i"); k.style.cssText = "position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);padding:10px;font-style:normal;color:#fff;background:#000;opacity:0.65;filter:Alpha(opacity=65);border-radius:5px;box-shadow: 0 0 10px #fff;-webkit-box-shadow: 0 0 10px #fff;z-index:9999;"; k.innerText = "刷新成功"; var h = document.getElementsByTagName("body")[0]; h.insertBefore(k, h.childNodes[0]); setTimeout(function () { h.removeChild(h.firstChild) }, 1000) } if (f == "1") { $("html,body").scrollTop(g) } SetCookie("sitPos", "0") } }) } function getrefdata() { var a = "http://" + window.location.host + "/ilerrshop?action=reflistinfo&p=" + refp + "&reftime" + $.cookie("reftime"); $.ajax({ type: "get", dataType: "json", timeout: 10000, url: a, success: function (d) { if (d.state == "0") { for (var c = 0; c < d.data.length; c++) { if ($("em[role=renshuLeft" + d.data[c].productid + "]")) { var b = (d.data[c].canyurenshu / d.data[c].zongrenshu) * 100; b = b.toFixed(2); $("em[role=renshuLeft" + d.data[c].productid + "]").text(d.data[c].shengyurenshu); $("#pgbar" + d.data[c].productid).width(b + "%") } } getdata(true) } else { getdata(true) } } }) } function getLottery(b) { if (b) { $("#singleLottery").html(""); $("#singleLottery").attr("style", "top:0;position:relative;padding:0;margin:0;") } var a = "http://" + window.location.host + "/ilerrbuy?action=listwill&num=1"; var c = ""; $.ajax({ type: "get", dataType: "json", timeout: 10000, url: a, success: function (f) { if (f.state == 1) { getLotteryList(); return } c += '<li class="JJJX"><a href="index.item.aspx?shopid=' + f.data[0].yId + '">即将揭晓<b>' + f.data[0].title + '</b><span class="daojis">倒计时<time role="daojishi" id="' + f.data[0].yId + '" leftTime="' + f.data[0].timeSpan + '"></time></span><i class="z-arrow"></i></a></li>'; $("#singleLottery").append(c); if (tSlide != null) { tSlide.slide.customType = "stop" } var g = $("[role='daojishi']"); var e = parseInt(g.attr("leftTime")); var d = new startTimeOut(g, e, "singleLottery"); d.countdown() } }) } var lotteryScroll; function getLotteryList(c) { var a = "http://" + window.location.host + "/ilerrbuy?action=listinfo"; var b = ""; $.ajax({ type: "get", dataType: "json", timeout: 10000, url: a, success: function (e) { if (e.count == 0) { return } for (var d = 0; d < e.data.length; d++) { b += '<li><a href="index.item.aspx?shopid=' + e.data[d].yId + '">恭喜<i>' + e.data[d].username + "</i>获得<b>" + e.data[d].title + '</b><i class="z-arrow"></i></a></li>' } $("#singleLottery").append(b); setTimeout("timer()", 1000); if (c == "won") { tSlide = null } } }) } var tDataVer = 1; var tSlide = null; function timer() { if (tSlide == null) { tSlide = jQuery(".txtScroll-top").slide({ titCell: ".hd ul", mainCell: ".bd ul", autoPage: true, effect: "top", autoPlay: true, vis: 1, mouseOverStop: true }) } var c = $("#singleLottery").get(0); var b = Math.abs(c.style.top.replace("px", "")); var a = b / 25; setTimeout("timer()", 3000) } function setWxShareInfoDefault() { var b = "http://" + window.location.host + "/images/icon/taotaole.png"; var d = "爽乐购一元夺宝"; var e = "每天淘宝，每天爽乐购，全场商品1元钱！"; var c = "http://" + window.location.host + "/index.aspx"; WinXinShareMessage(d, e, c, b); document.addEventListener("WeixinJSBridgeReady", function a() { WeixinJSBridge.call("showOptionMenu") }) } function getSlidePic() { var a = "http://" + window.location.host + "/ilerrarticle?action=slides&slidetype=1"; $.ajax({ type: "get", dataType: "json", timeout: 10000, url: a, success: function (f) { for (var d = 0; d < f.data.length; d++) { var j = "window.location='" + f.data[d].slidelink + "'"; var b = ""; b += '<div  class="aui-slide-node"  onclick="' + j + '" ><img alt="" src="' + f.imgroot + f.data[d].slideimg + '"></div>'; $(".aui-slide-wrap").append(b) } var c = $("#aui-slide"); var h = $("#aui-slide img").eq(0); var g = $(h).width() * 189 / 600; var b = new auiSlide({ container: document.getElementById("aui-slide"), height: g, speed: 300, autoPlay: 3000, loop: true, pageShow: true, pageStyle: "dot", dotPosition: "center" }) } }) } $(window).scroll(function () { var a = GetCookie("sitPos"); if ($(window).scrollTop() == $(document).height() - $(window).height()) { if (a != "1") { getdata() } if (nextPage == 0) { $(".pullUpLabel").text("已加载完全部商品"); $(".pullUpLabel").prev().hide(); return } } });